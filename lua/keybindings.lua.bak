--- 设置Leader键
vim.g.mapleader = " "
vim.g.maplocalleader = " "
local map = vim.api.nvim_set_keymap
--- 复用 opt 参数
local opt = { noremap = true, silent = true }

-- 取消s键默认功能
map("n", "s", "", opt)
-- 新建窗口
map("n", "sn", "<C-w>n", opt)
map("n", "svn", ":vnew<CR>", opt)
-- 窗口分屏快捷键
map("n", "sv", ":vsplit<CR>", opt)
map("n", "sh", ":split<CR>", opt)
-- 关闭当前窗口
map("n", "sc", "<C-w>c", opt)
-- 关闭其他窗口
map("n", "so", "<C-w>o", opt)
-- Alt + hjkltb在窗口之间跳转
map("n", "<A-h>", "<C-w>h", opt)
map("n", "<A-j>", "<C-w>j", opt)
map("n", "<A-k>", "<C-w>k", opt)
map("n", "<A-l>", "<C-w>l", opt)
map("n", "<A-t>", "<C-w>t", opt)
map("n", "<A-b>", "<C-w>b", opt)

-- 左右比例调整
map("n", "<C-Left>", ":vertical resize -2<CR>", opt)
map("n", "<C-Right>", ":vertical resize +2<CR>", opt)
map("n", "s,", ":vertical resize -20<CR>", opt)
map("n", "s.", ":vertical resize +20<CR>", opt)
-- 上下比例调整
map("n", "sj", ":resize +10<CR>", opt)
map("n", "sk", ":resize -10<CR>", opt)
map("n", "<C-Down>", ":resize +2<CR>", opt)
map("n", "<C-Up>", ":resize -2<CR>", opt)
-- 等比例调整
map("n", "s=", "<C-w>=", opt)

-- Terminal相关操作
map("n", "<leader>t", ":sp | terminal<CR>", opt)
map("n", "<leader>vt", ":vsp | terminal<CR>", opt)

-- 上下滚动浏览
map("n", "<C-j>", "4j", opt)
map("n", "<C-k>", "4k", opt)
-- ctrl + u / ctrl + d只移动9行，默认移动半屏
map("n", "<C-u>", "9k", opt)
map("n", "<C-d>", "9j", opt)

-- 退出
map("n", "<ESC>", ":q<CR>", opt)
map("n", "<ESC><ESC>", ":q!<CR>", opt)
map("n", "<ESC>q", ":qa!<CR>", opt)
--
-- 保存文件
map("n", "<C-s>", ":write<CR>", opt)
map("n", "<C-S>", ":write all<CR>", opt)
-- 粘贴
map("n", "<C-p>", '"*p', opt)

--- terminal模式快捷键
map("t", "<A-h>", [[ <C-\><C-N><C-w>h ]], opt)
map("t", "<A-j>", [[ <C-\><C-N><C-w>j ]], opt)
map("t", "<A-k>", [[ <C-\><C-N><C-w>k ]], opt)
map("t", "<A-l>", [[ <C-\><C-N><C-w>l ]], opt)
map("t", "<Esc>", "<C-\\><C-n>", opt)

--- visual模式
-- 代码缩进
map("v", "<", "<gv", opt)
map("v", ">", ">gv", opt)
-- 上下移动选中文本
map("v", "J", ":move '>+1<CR>gv-gv", opt)
map("v", "K", ":move '<-2<CR>gv-gv", opt)
-- 复制
map("v", "<C-y>", '"+y', opt)

--- insert模式快捷键
-- 跳到行首行尾
map("i", "<C-h>", "<ESC>I", opt)
map("i", "<C-l>", "<ESC>A", opt)

--- 插件快捷键

--- nvim-tree插件快捷键
-- Alt+m打开或关闭目录树
map("n", "<A-m>", ":NvimTreeToggle<CR>", opt)
--- bufferline插件快捷键
-- 左右切换标签页
--map( "n", "b[", ":BufferLineCyclePrev<CR>", opt )
--map( "n", "b]", ":BufferLineCycleNext<CR>", opt )
-- 跳转到具体的buffer
--map("n", "<leader>1", ":BufferLineGoToBuffer 1<CR>", opt)
--map("n", "<leader>2", ":BufferLineGoToBuffer 2<CR>", opt)
--map("n", "<leader>3", ":BufferLineGoToBuffer 3<CR>", opt)
--map("n", "<leader>4", ":BufferLineGoToBuffer 4<CR>", opt)
--map("n", "<leader>6", ":BufferLineGoToBuffer 5<CR>", opt)
--map("n", "<leader>6", ":BufferLineGoToBuffer 6<CR>", opt)
--map("n", "<leader>7", ":BufferLineGoToBuffer 7<CR>", opt)
--map("n", "<leader>8", ":BufferLineGoToBuffer 8<CR>", opt)
--map("n", "<leader>9", ":BufferLineGoToBuffer 9<CR>", opt)
--map("n", "<leader>$", ":BufferLineGoToBuffer -1<CR>", opt)
-- 关闭标签页
map("n", "<C-w>", ":bdelete!<CR>", opt)
--map("n", "<leader>bl", ":BufferlineCloseRight<CR>", opt)
--map("n", "<leader>bh", ":BufferlineCloseLeft<CR>", opt)
--map("n", "<leader>gd", ":BufferLinePickClose<CR>", opt)
--map("n", "<Leader>gb", ":BufferLinePick<CR>", opt)
--map("n", "<Leader>gp", ":BufferLineTogglePin<CR>", opt)
--- Telescope插件快捷键
-- 调用Telescope
--local ts_builtin = require("telescope.builtin")
--local ts_extensions = require("telescope").extensions
--- 三种设置快捷键的方式
--map( "n", "<leader>fb", ":Telescope file_browser<CR>", opt )
--map( "n", "<leader>fg", ":lua require('telescope').extensions.live_grep_args.live_grep_args()<CR>", opt )
--vim.keymap.set( 'n', '<leader>fb', require('telescope').extensions.file_browser.file_browser, opt )
--vim.keymap.set("n", "<leader>ff", ts_builtin.find_files, opt)
--vim.keymap.set("n", "<leader>fh", ts_builtin.help_tags, opt)
--vim.keymap.set("n", "<leader>fb", ts_extensions.file_browser.file_browser, opt)
--vim.keymap.set("n", "<leader>fg", ts_extensions.live_grep_args.live_grep_args, opt)
--vim.keymap.set("n", "<leader>fp", "<CMD>Telescope projects<CR>", opt)
-- Telescope窗口操作快捷键
--- trouble插件快捷键
map("n", "<leader>xx", ":TroubleToggle<CR>", opt)
map("n", "<leader>xw", ":TroubleToggle workspace_diagnostics<CR>", opt)
map("n", "<leader>xd", ":TroubleToggle document_diagnostics<CR>", opt)
map("n", "<leader>xl", ":TroubleToggle loclist<CR>", opt)
map("n", "<leader>xq", ":TroubleToggle quickfix<CR>", opt)
map("n", "gR", ":TroubleToggle lsp_references<CR>", opt)
--- lsp快捷键绑定
-- lsp 回调函数快捷键设置
